<html>
<header>
  <title>Audio</title>
</header>

<body>
  <h1>audio experiment</h1>

  <button id="listenButton">listen</button>
  <button id="playButton">play</button>

  <input id="number" type="number" value="440" step="10">

  <script>
    var button = document.getElementById('listenButton');
    var playButton = document.getElementById('playButton');
    var number = document.getElementById('number');

    var context = new AudioContext();

    var gain = context.createGain()
    gain.gain.setValueAtTime(0.2, context.currentTime);
    gain.connect(context.destination)

    var oscillator = context.createOscillator();
    oscillator.type = 'square';
    oscillator.frequency.setValueAtTime(440, context.currentTime); // value in hertz
    oscillator.start();
    
    button.addEventListener("mousedown", function(){
      oscillator.frequency.setValueAtTime(number.value, context.currentTime); // value in hertz    
      oscillator.connect(gain); 
    });

    button.addEventListener("mouseup", function() {
      oscillator.disconnect(gain)
    });

    playButton.addEventListener("mousedown", function(){
      newCodedOscillator([5,7,1,3,9]);
    });

    function newOscillator() {
      var oscillator = context.createOscillator();
      oscillator.type = 'square';
      oscillator.frequency.setValueAtTime(440, context.currentTime); // value in hertz
      oscillator.frequency.setValueAtTime(440 * Math.pow(2, 1/12), context.currentTime + 1);
      oscillator.frequency.setValueAtTime(440 * Math.pow(2, 2/12), context.currentTime + 2);
      oscillator.frequency.setValueAtTime(440 * Math.pow(2, 3/12), context.currentTime + 3);
      oscillator.connect(gain); 
      oscillator.start();
      oscillator.stop(context.currentTime + 4);
    }

    function newCodedOscillator(intCodes) {
      var oscillator = context.createOscillator();
      oscillator.type = 'square';
      for (i = 0; i < intCodes.length; i++) {
        oscillator.frequency.setValueAtTime(440 * Math.pow(2, intCodes[i]/12), context.currentTime + i);
      }
      oscillator.connect(gain); 
      oscillator.start();
      oscillator.stop(context.currentTime + intCodes.length+1);
    }
  </script>


</body>

</html>